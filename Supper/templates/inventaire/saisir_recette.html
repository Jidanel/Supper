{% extends "admin/base_site.html" %}
{% load static i18n %}

{% block title %}Saisir une recette{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3><i class="fas fa-coins"></i> Saisir une recette journalière</h3>
                </div>
                <div class="card-body">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            {{ form.errors }}
                        </div>
                        {% endif %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.poste.label_tag }}
                                {{ form.poste }}
                            </div>
                            <div class="col-md-6">
                                {{ form.date.label_tag }}
                                {{ form.date }}
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.montant_declare.label_tag }}
                                <div class="input-group">
                                    {{ form.montant_declare }}
                                    <span class="input-group-text">FCFA</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    {{ form.lier_inventaire }}
                                    {{ form.lier_inventaire.label_tag }}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            {{ form.observations.label_tag }}
                            {{ form.observations }}
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Enregistrer la recette
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Statistiques rapides -->
            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    <h5>Statistiques du mois</h5>
                </div>
                <div class="card-body">
                    <p>Total du mois : <strong>{{ stats.total_mois|floatformat:0|default:"0" }} FCFA</strong></p>
                    <p>Taux moyen : <strong>{{ stats.moyenne_taux|floatformat:2|default:"0" }}%</strong></p>
                </div>
            </div>
            
            <!-- Recettes récentes -->
            <div class="card">
                <div class="card-header">
                    <h5>Recettes récentes</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for recette in recettes_recentes %}
                        <a href="{% url 'inventaire:recette_detail' recette.pk %}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between">
                                <small>{{ recette.date|date:"d/m" }}</small>
                                <small>{{ recette.montant_declare|floatformat:0 }} FCFA</small>
                            </div>
                            <small class="text-muted">{{ recette.poste.nom }}</small>
                        </a>
                        {% empty %}
                        <p class="text-muted">Aucune recette récente</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}