{% extends "admin/base_site.html" %}
{% load static %}
{% load i18n %}
{% load inventaire_extras %}
{% comment %}
===================================================================
templates/admin/index.html - Template Dashboard SUPPER RESPONSIVE
Version mobile optimis√©e - Correction d√©filement horizontal
CHEMIN: Supper/templates/admin/index.html
===================================================================
{% endcomment %}

{% block title %}{{ title }} - SUPPER{% endblock %}

{% block content %}
<!-- STYLES INT√©GR√©S DIRECTEMENT - VERSION MOBILE OPTIMIS√©E -->
<style>
    /* ============================================
       RESET GLOBAL - CORRECTION D√©FILEMENT HORIZONTAL
       ============================================ */
    .supper-dashboard * { 
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        max-width: 100%;
    }
    
    .supper-dashboard {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        min-height: calc(100vh - 80px);
        padding: 1.5rem;
        margin: -20px;
        margin-top: 0;
        width: 100%;
        overflow-x: hidden !important;
        position: relative;
    }
    
    /* Correction fondamentale pour mobile */
    @media (max-width: 768px) {
        .supper-dashboard {
            padding: 1rem !important;
            margin: 0 !important;
            width: 100vw !important;
            max-width: 100vw !important;
            overflow-x: hidden !important;
        }
        
        /* √©viter tout d√©bordement */
        .supper-dashboard > * {
            max-width: 100% !important;
            overflow-x: hidden !important;
        }
    }
    
    .supper-container {
        max-width: 1600px;
        margin: 0 auto;
        width: 100%;
        overflow-x: hidden !important;
        position: relative;
    }
    
    /* ============================================
       EN-T√äTE - RESPONSIVE COMPLETE
       ============================================ */
    .supper-header {
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        border-radius: 16px;
        padding: 1.5rem 2rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        color: #fff;
        width: 100%;
        position: relative;
        overflow: hidden;
    }
    
    .supper-header h1 {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 800;
        color: #fff;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
        flex: 1;
        min-width: 0;
    }
    
    .supper-header-sub {
        color: rgba(255,255,255,0.9);
        font-size: 0.95rem;
        margin-top: 0.25rem;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
        width: 100%;
    }
    
    .supper-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255,255,255,0.2);
        border-radius: 50px;
        font-size: 0.8rem;
        color: #fff;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    /* ============================================
       ACTIONS RAPIDES - GRID RESPONSIVE
       ============================================ */
    .supper-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
        width: 100%;
        position: relative;
    }
    
    .supper-action-card {
        background: #fff;
        border-radius: 12px;
        padding: 1.25rem;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
        width: 100%;
        min-height: 86px;
        overflow: hidden;
        position: relative;
    }
    
    .supper-action-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px -5px rgba(0,0,0,0.15);
        border-color: #3b82f6;
    }
    
    .supper-action-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: #fff;
        flex-shrink: 0;
    }
    
    .supper-action-icon.primary { background: linear-gradient(135deg, #1e40af, #3b82f6); }
    .supper-action-icon.success { background: linear-gradient(135deg, #059669, #10b981); }
    .supper-action-icon.warning { background: linear-gradient(135deg, #d97706, #f59e0b); }
    .supper-action-icon.danger { background: linear-gradient(135deg, #dc2626, #ef4444); }
    .supper-action-icon.info { background: linear-gradient(135deg, #0891b2, #22d3ee); }
    .supper-action-icon.secondary { background: linear-gradient(135deg, #475569, #64748b); }
    
    .supper-action-text {
        font-weight: 600;
        font-size: 0.9rem;
        color: #1e293b;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
        flex: 1;
    }
    
    /* ============================================
       STATISTIQUES - GRID RESPONSIVE
       ============================================ */
    .supper-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
        width: 100%;
        position: relative;
    }
    
    .supper-stat-card {
        background: #fff;
        border-radius: 12px;
        padding: 1.25rem;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        position: relative;
        overflow: hidden;
        width: 100%;
    }
    
    .supper-stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
    }
    
    .supper-stat-card.blue::before { background: linear-gradient(90deg, #1e40af, #3b82f6); }
    .supper-stat-card.cyan::before { background: linear-gradient(90deg, #0891b2, #22d3ee); }
    .supper-stat-card.green::before { background: linear-gradient(90deg, #059669, #10b981); }
    .supper-stat-card.amber::before { background: linear-gradient(90deg, #d97706, #f59e0b); }
    .supper-stat-card.red::before { background: linear-gradient(90deg, #dc2626, #ef4444); }
    .supper-stat-card.purple::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6); }
    
    .supper-stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
        width: 100%;
        gap: 0.5rem;
    }
    
    .supper-stat-label {
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #64748b;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
        flex: 1;
    }
    
    .supper-stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: #fff;
        flex-shrink: 0;
    }
    
    .supper-stat-icon.blue { background: linear-gradient(135deg, #1e40af, #3b82f6); }
    .supper-stat-icon.cyan { background: linear-gradient(135deg, #0891b2, #22d3ee); }
    .supper-stat-icon.green { background: linear-gradient(135deg, #059669, #10b981); }
    .supper-stat-icon.amber { background: linear-gradient(135deg, #d97706, #f59e0b); }
    .supper-stat-icon.red { background: linear-gradient(135deg, #dc2626, #ef4444); }
    .supper-stat-icon.purple { background: linear-gradient(135deg, #7c3aed, #8b5cf6); }
    
    .supper-stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #0f172a;
        line-height: 1.2;
        margin-bottom: 0.25rem;
        word-break: break-word;
        overflow-wrap: break-word;
        width: 100%;
    }
    
    .supper-stat-detail {
        font-size: 0.8rem;
        color: #64748b;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
        width: 100%;
    }
    
    /* ============================================
       SECTIONS PRINCIPALES
       ============================================ */
    .supper-section {
        background: #fff;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        margin-bottom: 1.5rem;
        width: 100%;
        overflow: hidden;
        position: relative;
    }
    
    .supper-section-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0f172a;
        margin: 0 0 1.25rem 0;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #dbeafe;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.75rem;
        width: 100%;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-section-title i {
        color: #1e40af;
        flex-shrink: 0;
    }
    
    .supper-section-meta {
        font-size: 0.8rem;
        color: #64748b;
        font-weight: 400;
        margin-left: auto;
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
        text-align: right;
    }
    
    /* ============================================
       BARRE DE PROGRESSION
       ============================================ */
    .supper-progress {
        background: #dbeafe;
        height: 28px;
        border-radius: 14px;
        overflow: hidden;
        margin: 1rem 0;
        width: 100%;
        position: relative;
    }
    
    .supper-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #1e40af, #3b82f6);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 600;
        font-size: 0.8rem;
        min-width: 50px;
        white-space: nowrap;
    }
    
    /* ============================================
       OBJECTIFS - GRID RESPONSIVE
       ============================================ */
    .supper-objectives {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1rem;
        width: 100%;
        position: relative;
    }
    
    .supper-objective {
        text-align: center;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        width: 100%;
        overflow: hidden;
    }
    
    .supper-objective-label {
        font-size: 0.75rem;
        color: #64748b;
        margin-bottom: 0.25rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-objective-value {
        font-size: 1.25rem;
        font-weight: 700;
        word-break: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-objective-value.blue { color: #1e40af; }
    .supper-objective-value.green { color: #059669; }
    .supper-objective-value.amber { color: #d97706; }
    
    .supper-objective-unit {
        font-size: 0.7rem;
        color: #94a3b8;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    /* ============================================
       GRAPHIQUES - RESPONSIVE
       ============================================ */
    .supper-charts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
        width: 100%;
        position: relative;
    }
    
    .supper-chart-container {
        position: relative;
        height: 280px;
        width: 100%;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-chart-container canvas {
        width: 100% !important;
        height: 100% !important;
        max-width: 100%;
    }
    
    /* ============================================
       CLASSEMENT - RESPONSIVE
       ============================================ */
    .supper-rank {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        padding: 1.25rem;
        background: #eff6ff;
        border-radius: 12px;
        border: 1px solid #dbeafe;
        width: 100%;
        flex-wrap: wrap;
        overflow: hidden;
    }
    
    .supper-rank-badge {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 1.5rem;
        flex-shrink: 0;
        box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    }
    
    .supper-rank-badge.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; }
    .supper-rank-badge.silver { background: linear-gradient(135deg, #d1d5db, #9ca3af); color: #374151; }
    .supper-rank-badge.bronze { background: linear-gradient(135deg, #d97706, #b45309); color: #fff; }
    .supper-rank-badge.default { background: linear-gradient(135deg, #1e40af, #3b82f6); color: #fff; }
    .supper-rank-badge.purple { background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: #fff; }
    
    .supper-rank-info {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-rank-info h4 {
        margin: 0 0 0.25rem 0;
        font-size: 1rem;
        font-weight: 700;
        color: #1e3a8a;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-rank-info p {
        margin: 0;
        font-size: 0.85rem;
        color: #334155;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-rank-info small {
        font-size: 0.75rem;
        color: #475569;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    /* ============================================
       STATISTIQUES PESAGE - GRID RESPONSIVE
       ============================================ */
    .supper-pesage-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 0.75rem;
        width: 100%;
        position: relative;
    }
    
    .supper-pesage-stat {
        text-align: center;
        padding: 1rem;
        border-radius: 10px;
        color: #fff;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-pesage-stat.purple { background: linear-gradient(135deg, #7c3aed, #8b5cf6); }
    .supper-pesage-stat.amber { background: linear-gradient(135deg, #d97706, #f59e0b); }
    .supper-pesage-stat.blue { background: linear-gradient(135deg, #1e40af, #3b82f6); }
    .supper-pesage-stat.green { background: linear-gradient(135deg, #059669, #10b981); }
    .supper-pesage-stat.red { background: linear-gradient(135deg, #dc2626, #ef4444); }
    .supper-pesage-stat.outline {
        background: #fff;
        border: 2px dashed #cbd5e1;
        color: #334155;
    }
    .supper-pesage-stat.outline.warning-border { border-color: #f59e0b; }
    .supper-pesage-stat.outline.success-border { border-color: #10b981; }
    
    .supper-pesage-stat-label {
        font-size: 0.7rem;
        opacity: 0.9;
        margin-bottom: 0.375rem;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-pesage-stat-value {
        font-size: 1.25rem;
        font-weight: 700;
        line-height: 1.2;
        word-break: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-pesage-stat-unit {
        font-size: 0.65rem;
        opacity: 0.8;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    /* ============================================
       STATISTIQUES MENSUELLES
       ============================================ */
    .supper-month-stats {
        margin-top: 1.25rem;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        width: 100%;
        overflow: hidden;
    }
    
    .supper-month-stats h4 {
        font-size: 0.85rem;
        font-weight: 600;
        color: #334155;
        margin: 0 0 0.75rem 0;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-month-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 0.75rem;
        width: 100%;
    }
    
    .supper-month-item {
        text-align: center;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-month-item label {
        font-size: 0.7rem;
        color: #64748b;
        display: block;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-month-item span {
        font-size: 1rem;
        font-weight: 700;
        display: block;
        word-break: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-month-item span.blue { color: #1e40af; }
    .supper-month-item span.amber { color: #d97706; }
    .supper-month-item span.green { color: #059669; }
    .supper-month-item span.red { color: #dc2626; }
    .supper-month-item span.purple { color: #7c3aed; }
    
    /* ============================================
       ALERTES - RESPONSIVE
       ============================================ */
    .supper-alert {
        margin-top: 1rem;
        padding: 0.875rem 1rem;
        border-radius: 10px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.75rem;
        width: 100%;
        overflow: hidden;
    }
    
    .supper-alert.warning {
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
    }
    
    .supper-alert.info {
        background: #eff6ff;
        border-left: 4px solid #3b82f6;
    }
    
    .supper-alert i {
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    
    .supper-alert.warning i { color: #f59e0b; }
    .supper-alert.info i { color: #3b82f6; }
    
    .supper-alert-content {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-alert-content strong {
        display: block;
        font-size: 0.875rem;
        color: #1e293b;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-alert-content small {
        font-size: 0.8rem;
        color: #475569;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-alert-action {
        margin-left: auto;
        padding: 0.5rem 0.875rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.8rem;
        color: #fff;
        background: #f59e0b;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    /* ============================================
       BOUTONS D'ACTION - RESPONSIVE
       ============================================ */
    .supper-actions-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        border-top: 1px solid #e2e8f0;
        width: 100%;
        position: relative;
    }
    
    .supper-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 0.875rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.8rem;
        transition: all 0.2s ease;
        position: relative;
        white-space: nowrap;
        text-align: center;
        flex: 1;
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
    }
    
    .supper-btn.purple { background: #7c3aed; color: #fff; }
    .supper-btn.indigo { background: #6366f1; color: #fff; }
    .supper-btn.green { background: #059669; color: #fff; }
    .supper-btn.pink { background: #ec4899; color: #fff; }
    .supper-btn.blue { background: #1e40af; color: #fff; }
    .supper-btn.outline { background: #fff; color: #475569; border: 1px solid #cbd5e1; }
    
    .supper-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }
    
    .supper-btn .badge {
        position: absolute;
        top: -6px;
        right: -6px;
        background: #ef4444;
        color: #fff;
        font-size: 0.65rem;
        padding: 0.125rem 0.375rem;
        border-radius: 50px;
        font-weight: 600;
    }
    
    /* ============================================
       BOUTON LIEN
       ============================================ */
    .supper-link-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.625rem 1.25rem;
        background: #1e40af;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.875rem;
        white-space: nowrap;
        text-align: center;
        max-width: 100%;
        overflow: hidden;
    }
    
    .supper-link-btn:hover {
        background: #1e3a8a;
    }
    
    /* ============================================
       LISTE D'ACTIVIT√©S
       ============================================ */
    .supper-activity-list {
        list-style: none;
        padding: 0;
        margin: 0;
        width: 100%;
    }
    
    .supper-activity-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f5f9;
        width: 100%;
        flex-wrap: wrap;
        overflow: hidden;
    }
    
    .supper-activity-item:last-child {
        border-bottom: none;
    }
    
    .supper-activity-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #eff6ff;
        color: #3b82f6;
        font-size: 0.8rem;
        flex-shrink: 0;
    }
    
    .supper-activity-content {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }
    
    .supper-activity-content strong {
        display: block;
        font-size: 0.85rem;
        color: #1e293b;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-activity-content small {
        font-size: 0.75rem;
        color: #64748b;
        line-height: 1.4;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    .supper-activity-time {
        font-size: 0.7rem;
        color: #94a3b8;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    /* ============================================
       TABLEAU TOP POSTES - RESPONSIVE AVEC D√©FILEMENT
       ============================================ */
    .supper-top-postes-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-top: 1rem;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    
    .supper-top-postes-container::-webkit-scrollbar {
        display: none;
    }
    
    .supper-top-postes-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 600px;
    }
    
    .supper-top-postes-table thead {
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .supper-top-postes-table th {
        padding: 0.75rem;
        text-align: left;
        font-size: 0.75rem;
        color: #64748b;
        white-space: nowrap;
        font-weight: 600;
    }
    
    .supper-top-postes-table td {
        padding: 0.75rem;
        vertical-align: middle;
        border-bottom: 1px solid #f1f5f9;
        white-space: nowrap;
    }
    
    .supper-top-postes-table tr:last-child td {
        border-bottom: none;
    }
    
    /* ============================================
       RESPONSIVE BREAKPOINTS - OPTIMIS√© POUR MOBILE
       ============================================ */
    
    /* ============================================
       CORRECTION SP√©CIFIQUE POUR MOBILE
       ============================================ */
    @media (max-width: 768px) {
        /* CORRECTION CRITIQUE : html et body - Empeche le defilement horizontal */
        html, body {
            overflow-x: hidden !important;
            width: 100% !important;
            max-width: 100vw !important;
            position: relative !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* CORRECTION CRITIQUE : conteneurs de base_site.html */
        .main-content {
            overflow-x: hidden !important;
            width: 100% !important;
            max-width: 100vw !important;
        }
        
        .content-wrapper {
            min-width: 100% !important;
            width: 100% !important;
            max-width: 100vw !important;
            padding: 0.75rem !important;
            overflow-x: hidden !important;
        }
        
        /* Correction globale dashboard */
        .supper-dashboard {
            padding: 0.75rem !important;
            margin: 0 !important;
            width: 100% !important;
            max-width: 100vw !important;
            overflow-x: hidden !important;
        }
        
        .supper-container {
            width: 100% !important;
            max-width: 100% !important;
            overflow-x: hidden !important;
            padding: 0 !important;
        }
        
        /* Header mobile */
        .supper-header {
            flex-direction: column;
            align-items: flex-start;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        .supper-header h1 {
            font-size: 1.35rem;
            width: 100%;
        }
        
        .supper-header-sub {
            font-size: 0.85rem;
            width: 100%;
        }
        
        .supper-badge {
            align-self: flex-start;
            font-size: 0.75rem;
            padding: 0.4rem 0.75rem;
        }
        
        /* Stats - 1 colonne */
        .supper-stats {
            grid-template-columns: 1fr !important;
            gap: 0.75rem;
        }
        
        .supper-stat-card {
            padding: 1rem;
            width: 100%;
        }
        
        .supper-stat-value {
            font-size: 1.5rem;
        }
        
        /* Actions rapides - 1 colonne */
        .supper-actions {
            grid-template-columns: 1fr !important;
        }
        
        .supper-action-card {
            padding: 1rem;
            min-height: 75px;
            width: 100%;
        }
        
        .supper-action-icon {
            width: 42px;
            height: 42px;
            font-size: 1.1rem;
        }
        
        /* Sections */
        .supper-section {
            padding: 1.25rem;
            border-radius: 10px;
            width: 100%;
        }
        
        .supper-section-title {
            font-size: 1rem;
            margin-bottom: 1rem;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .supper-section-meta {
            margin-left: 0;
            font-size: 0.75rem;
            text-align: left;
            width: 100%;
        }
        
        /* Objectifs */
        .supper-objectives {
            grid-template-columns: 1fr !important;
            gap: 0.75rem;
        }
        
        /* Classement */
        .supper-rank {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
            padding: 1rem;
        }
        
        .supper-rank-info {
            text-align: center;
            width: 100%;
        }
        
        .supper-rank-badge {
            width: 56px;
            height: 56px;
            font-size: 1.25rem;
        }
        
        /* Graphiques */
        .supper-charts {
            grid-template-columns: 1fr !important;
            gap: 1rem;
        }
        
        .supper-chart-container {
            height: 250px;
        }
        
        /* Stats pesage */
        .supper-pesage-stats {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        /* Grid mensuel */
        .supper-month-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        /* Alertes */
        .supper-alert {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .supper-alert-action {
            margin-left: 0;
            align-self: flex-start;
        }
        
        /* Barre d'actions */
        .supper-actions-bar {
            gap: 0.4rem;
        }
        
        .supper-btn {
            flex: 1 0 calc(50% - 0.4rem);
            min-width: calc(50% - 0.4rem);
            font-size: 0.75rem;
            padding: 0.4rem 0.75rem;
            white-space: normal;
            line-height: 1.2;
            height: auto;
            min-height: 40px;
        }
        
        /* Activit√©s */
        .supper-activity-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        
        .supper-activity-icon {
            align-self: flex-start;
        }
        
        .supper-activity-content {
            min-width: 100%;
        }
        
        .supper-activity-time {
            align-self: flex-start;
        }
        
        /* Tableau */
        .supper-top-postes-container {
            margin-left: -0.75rem;
            margin-right: -0.75rem;
            width: calc(100% + 1.5rem);
            border-radius: 0;
            border-left: none;
            border-right: none;
        }
        
        .supper-top-postes-table {
            min-width: 500px;
            font-size: 0.8rem;
        }
        
        /* Bouton lien */
        .supper-link-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            justify-content: center;
        }
    }
    
    /* ============================================
       TRES PETITS √©CRANS (√¢‚Ä∞¬§ 576px)
       ============================================ */
    @media (max-width: 576px) {
        /* Renforcement des corrections de defilement */
        .content-wrapper {
            padding: 0.5rem !important;
        }
        
        .supper-dashboard {
            padding: 0.5rem !important;
        }
        
        .supper-header {
            padding: 0.875rem;
            border-radius: 10px;
        }
        
        .supper-header h1 {
            font-size: 1.25rem;
        }
        
        .supper-header-sub {
            font-size: 0.8rem;
        }
        
        .supper-stat-card {
            padding: 0.875rem;
        }
        
        .supper-stat-value {
            font-size: 1.35rem;
        }
        
        .supper-section {
            padding: 1rem;
            border-radius: 8px;
        }
        
        .supper-section-title {
            font-size: 0.95rem;
        }
        
        .supper-pesage-stats {
            grid-template-columns: 1fr !important;
        }
        
        .supper-month-grid {
            grid-template-columns: 1fr !important;
        }
        
        .supper-btn {
            flex: 1 0 100% !important;
            font-size: 0.7rem;
            margin-bottom: 0.3rem;
        }
        
        .supper-top-postes-container {
            margin-left: -0.5rem;
            margin-right: -0.5rem;
            width: calc(100% + 1rem);
        }
    }
    
    /* ============================================
       MOBILE TR√àS PETIT (‚â§ 375px)
       ============================================ */
    @media (max-width: 375px) {
        /* Renforcement des corrections de defilement */
        .content-wrapper {
            padding: 0.25rem !important;
        }
        
        .supper-dashboard {
            padding: 0.25rem !important;
        }
        
        .supper-header {
            padding: 0.75rem;
        }
        
        .supper-header h1 {
            font-size: 1.15rem;
        }
        
        .supper-actions-bar {
            flex-direction: column;
        }
        
        .supper-btn {
            flex: 1 0 100% !important;
            width: 100%;
            margin-bottom: 0.25rem;
        }
        
        .supper-chart-container {
            height: 200px;
        }
        
        .supper-top-postes-container {
            margin-left: -0.25rem;
            margin-right: -0.25rem;
            width: calc(100% + 0.5rem);
        }
    }
    
    /* ============================================
       ORIENTATION PAYSAGE SUR MOBILE
       ============================================ */
    @media (max-width: 896px) and (orientation: landscape) {
        .supper-stats {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        .supper-actions {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        .supper-objectives {
            grid-template-columns: repeat(3, 1fr) !important;
        }
        
        .supper-pesage-stats {
            grid-template-columns: repeat(3, 1fr) !important;
        }
        
        .supper-month-grid {
            grid-template-columns: repeat(3, 1fr) !important;
        }
        
        .supper-btn {
            flex: 1 0 calc(33% - 0.4rem) !important;
            min-width: calc(33% - 0.4rem) !important;
        }
        
        .supper-rank {
            flex-direction: row;
            text-align: left;
        }
        
        .supper-rank-info {
            text-align: left;
        }
    }
    
    /* ============================================
       CORRECTION DU ZOOM SUR iOS
       ============================================ */
    @media (max-width: 768px) {
        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="email"],
        input[type="password"],
        select,
        textarea,
        button {
            font-size: 16px !important;
        }
    }
    
    /* ============================================
       SCROLLBAR PERSONNALISEE - MOBILE
       ============================================ */
    @media (max-width: 768px) {
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    }
    
    /* ============================================
       GESTION DE L'IMPRESSION
       ============================================ */
    @media print {
        .supper-dashboard {
            background: white !important;
            padding: 0 !important;
            margin: 0 !important;
            width: 100% !important;
        }
        
        .supper-container {
            max-width: 100% !important;
        }
        
        .supper-header {
            box-shadow: none !important;
            border-radius: 0 !important;
            background: white !important;
            color: black !important;
            padding: 1rem !important;
        }
        
        .supper-header h1 {
            color: black !important;
        }
        
        .supper-header-sub {
            color: black !important;
        }
        
        .supper-badge {
            display: none !important;
        }
        
        .supper-action-card,
        .supper-stat-card,
        .supper-section {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
            page-break-inside: avoid;
        }
        
        .supper-btn,
        .supper-link-btn,
        .supper-alert-action {
            display: none !important;
        }
        
        .supper-top-postes-container {
            overflow-x: visible !important;
        }
        
        .supper-top-postes-table {
            min-width: 100% !important;
        }
    }
</style>

<!-- CONTENU DU DASHBOARD -->
<div class="supper-dashboard">
    <div class="supper-container">
        
        <!-- ============================================================ -->
        <!-- EN-T√äTE -->
        <!-- ============================================================ -->
        <div class="supper-header">
            <div style="width: 100%;">
                <h1>{% trans "Tableau de Bord" %} SUPPER</h1>
                <div class="supper-header-sub">
                    {% trans "Bienvenue," %} <strong>{{ user_stats.nom_complet }}</strong> 
                    ({{ user_stats.habilitation }})
                    {% if user_stats.poste_affectation %}
                        - {{ user_stats.poste_affectation.nom }}
                    {% endif %}
                </div>
            </div>
            <div class="supper-badge">
                <i class="fas fa-clock"></i>
                <span id="current-time"></span>
            </div>
        </div>

        <!-- ============================================================ -->
        <!-- ACTIONS RAPIDES -->
        <!-- ============================================================ -->
        {% if actions_rapides %}
        <div class="supper-actions">
            {% for action in actions_rapides %}
            <a href="{{ action.url }}" class="supper-action-card">
                <div class="supper-action-icon {% if 'primary' in action.class %}primary{% elif 'success' in action.class %}success{% elif 'warning' in action.class %}warning{% elif 'danger' in action.class %}danger{% elif 'info' in action.class %}info{% elif 'secondary' in action.class %}secondary{% else %}primary{% endif %}">
                    <i class="{{ action.icon }}"></i>
                </div>
                <span class="supper-action-text">{{ action.titre }}</span>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        {% if rang_agent_inventaire %}
        <div class="supper-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); border-left: 4px solid #f59e0b;">
            <h2 class="supper-section-title" style="color: #78350f;">
                <i class="fas fa-medal" style="color: #f59e0b;"></i>
                {% trans "Votre Classement Agent d'Inventaire" %}
                <span class="supper-section-meta" style="color: #92400e;">
                    {{ current_month }} {{ current_year }}
                </span>
            </h2>
            
            <div class="supper-rank" style="background: linear-gradient(135deg, #fff7ed, #ffedd5); border-color: #fed7aa;">
                <!-- Badge de rang -->
                <div class="supper-rank-badge {% if rang_agent_inventaire.rang == 1 %}gold{% elif rang_agent_inventaire.rang == 2 %}silver{% elif rang_agent_inventaire.rang == 3 %}bronze{% elif rang_agent_inventaire.rang <= 5 %}purple{% else %}default{% endif %}">
                    {% if rang_agent_inventaire.rang == 1 %}
                        ü•á
                    {% elif rang_agent_inventaire.rang == 2 %}
                        ü•à
                    {% elif rang_agent_inventaire.rang == 3 %}
                        ü•â
                    {% elif rang_agent_inventaire.rang <= 5 %}
                        ‚≠ê
                    {% else %}
                        {{ rang_agent_inventaire.rang }}
                    {% endif %}
                </div>
                
                <!-- Informations de rang -->
                <div class="supper-rank-info" style="flex: 1;">
                    <h4 style="color: #78350f; margin-bottom: 0.5rem;">
                        {% if rang_agent_inventaire.rang == 1 %}
                            üèÜ {% trans "Champion du mois !" %}
                        {% elif rang_agent_inventaire.rang <= 3 %}
                            üåü {% trans "Podium du mois !" %}
                        {% elif rang_agent_inventaire.rang <= 5 %}
                            üëè {% trans "Top 5 du mois" %}
                        {% else %}
                            üìä {% trans "Votre classement" %}
                        {% endif %}
                    </h4>
                    <p style="color: #92400e; font-size: 1.1rem; margin-bottom: 0.25rem;">
                        <strong>{{ rang_agent_inventaire.rang }}{% if rang_agent_inventaire.rang == 1 %}er{% else %}√®me{% endif %}</strong> 
                        {% trans "sur" %} {{ rang_agent_inventaire.total_agents }} {% trans "agents" %}
                    </p>
                    <small style="color: #a16207;">
                        {{ rang_agent_inventaire.message_performance }}
                    </small>
                </div>
                
                <!-- Note et statistiques -->
                <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.7); border-radius: 12px; min-width: 140px;">
                    <div style="font-size: 2rem; font-weight: 800; color: #b45309;">
                        {{ rang_agent_inventaire.note|floatformat:1 }}
                        <span style="font-size: 1rem; color: #92400e;">/20</span>
                    </div>
                    <div style="font-size: 0.75rem; color: #78350f; margin-top: 0.25rem;">
                        {% trans "Note globale" %}
                    </div>
                </div>
            </div>
            
            <!-- Statistiques d√©taill√©es -->
            <div class="supper-pesage-stats" style="margin-top: 1.25rem;">
                <!-- Jours travaill√©s -->
                <div class="supper-pesage-stat" style="background: linear-gradient(135deg, #059669, #10b981);">
                    <div class="supper-pesage-stat-label">
                        <i class="fas fa-calendar-check"></i> {% trans "Jours travaill√©s" %}
                    </div>
                    <div class="supper-pesage-stat-value">{{ rang_agent_inventaire.jours_travailles }}</div>
                    <div class="supper-pesage-stat-unit">{% trans "ce mois" %}</div>
                </div>
                
                <!-- Taux de pr√©sence -->
                <div class="supper-pesage-stat" style="background: linear-gradient(135deg, #1e40af, #3b82f6);">
                    <div class="supper-pesage-stat-label">
                        <i class="fas fa-percentage"></i> {% trans "Taux pr√©sence" %}
                    </div>
                    <div class="supper-pesage-stat-value">{{ rang_agent_inventaire.taux_presence|floatformat:0 }}%</div>
                    <div class="supper-pesage-stat-unit">{% trans "r√©gularit√©" %}</div>
                </div>
                
                <!-- Coh√©rence 3/3 crit√®res -->
                {% if rang_agent_inventaire.jours_3_criteres is not None %}
                <div class="supper-pesage-stat" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6);">
                    <div class="supper-pesage-stat-label">
                        <i class="fas fa-check-double"></i> {% trans "Coh√©rence 3/3" %}
                    </div>
                    <div class="supper-pesage-stat-value">{{ rang_agent_inventaire.jours_3_criteres }}</div>
                    <div class="supper-pesage-stat-unit">{% trans "jours parfaits" %}</div>
                </div>
                {% endif %}
                
                <!-- Jours impertinents (alerte si > 0) -->
                {% if rang_agent_inventaire.jours_impertinents > 0 %}
                <div class="supper-pesage-stat" style="background: linear-gradient(135deg, #dc2626, #ef4444);">
                    <div class="supper-pesage-stat-label">
                        <i class="fas fa-exclamation-triangle"></i> {% trans "Jours impertinents" %}
                    </div>
                    <div class="supper-pesage-stat-value">{{ rang_agent_inventaire.jours_impertinents }}</div>
                    <div class="supper-pesage-stat-unit">{% trans "attention" %}</div>
                </div>
                {% else %}
                <div class="supper-pesage-stat outline" style="border-color: #10b981;">
                    <div class="supper-pesage-stat-label" style="color: #059669;">
                        <i class="fas fa-check-circle"></i> {% trans "Aucun impertinent" %}
                    </div>
                    <div class="supper-pesage-stat-value" style="color: #059669;">‚úì</div>
                    <div class="supper-pesage-stat-unit" style="color: #10b981;">{% trans "parfait" %}</div>
                </div>
                {% endif %}
            </div>
            
            <!-- Lien vers le classement complet -->
            <div style="text-align: center; margin-top: 1.25rem;">
                <a href="{% url 'inventaire:classement_agents_performances' %}" class="supper-link-btn" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <i class="fas fa-trophy"></i>
                    {% trans "Voir le classement complet" %}
                </a>
            </div>
        </div>
        {% endif %}


        <!-- ============================================================ -->
        <!-- STATISTIQUES PRINCIPALES -->
        <!-- ============================================================ -->
        <div class="supper-stats">
            
            <!-- Stats Globales -->
            {% if can_view_global_stats and stats_globales %}
            <div class="supper-stat-card blue">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Utilisateurs" %}</span>
                    <div class="supper-stat-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_globales.total_utilisateurs }}</div>
                <div class="supper-stat-detail">{{ stats_globales.utilisateurs_actifs }} {% trans "actifs" %}</div>
            </div>

            <div class="supper-stat-card cyan">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Postes" %}</span>
                    <div class="supper-stat-icon cyan">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_globales.total_postes }}</div>
                <div class="supper-stat-detail">{{ stats_globales.postes_peage }} p√©age | {{ stats_globales.postes_pesage }} pesage</div>
            </div>
            {% endif %}

            <!-- Stats Inventaires -->
            {% if can_view_inventaires and stats_inventaires %}
            <div class="supper-stat-card green">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Inventaires Aujourd'hui" %}</span>
                    <div class="supper-stat-icon green">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_inventaires.inventaires_today }}</div>
                <div class="supper-stat-detail">{{ stats_inventaires.inventaires_semaine }} {% trans "cette semaine" %}</div>
            </div>
            {% endif %}

            <!-- Stats Recettes -->
            {% if can_view_recettes_peage and stats_recettes %}
            <div class="supper-stat-card amber">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Recettes du Mois" %}</span>
                    <div class="supper-stat-icon amber">
                        <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_recettes.montant_mois|floatformat:0|intcomma }}</div>
                <div class="supper-stat-detail">{{ stats_recettes.nombre_recettes_mois }} {% trans "recettes saisies" %} √¢‚Ç¨¬¢ FCFA</div>
            </div>

            <!-- Taux D√©perdition -->
            {% if stats_recettes.can_view_taux and stats_recettes.taux_moyen_mois is not None %}
            <div class="supper-stat-card {% if stats_recettes.taux_moyen_mois > -10 %}green{% elif stats_recettes.taux_moyen_mois > -30 %}amber{% else %}red{% endif %}">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Taux Moyen D√©perdition" %}</span>
                    <div class="supper-stat-icon {% if stats_recettes.taux_moyen_mois > -10 %}green{% elif stats_recettes.taux_moyen_mois > -30 %}amber{% else %}red{% endif %}">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_recettes.taux_moyen_mois|floatformat:2 }}%</div>
                {% if stats_recettes.can_view_potentiel and stats_recettes.ecart_mois is not None %}
                <div class="supper-stat-detail">{% trans "√©cart:" %} {{ stats_recettes.ecart_mois|floatformat:0|intcomma }} FCFA</div>
                {% endif %}
            </div>
            {% endif %}

            <div class="supper-stat-card blue">
                <div class="supper-stat-header">
                    <span class="supper-stat-label">{% trans "Recettes Aujourd'hui" %}</span>
                    <div class="supper-stat-icon blue">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                </div>
                <div class="supper-stat-value">{{ stats_recettes.recettes_today }}</div>
                <div class="supper-stat-detail">{{ stats_recettes.total_recettes }} {% trans "total" %}</div>
            </div>
            {% endif %}
        </div>

        <!-- ============================================================ -->
        <!-- OBJECTIFS ANNUELS -->
        <!-- ============================================================ -->
        {% if can_view_objectifs and stats_objectifs %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-bullseye"></i> 
                {% trans "Objectifs" %} {{ stats_objectifs.annee }}
                <span class="supper-section-meta">({{ stats_objectifs.nombre_postes }} postes actifs)</span>
            </h2>
            
            <div class="supper-progress">
                <div class="supper-progress-bar" style="width: {{ stats_objectifs.taux_realisation }}%;">
                    {{ stats_objectifs.taux_realisation|floatformat:1 }}%
                </div>
            </div>

            <div class="supper-objectives">
                <div class="supper-objective">
                    <div class="supper-objective-label">{% trans "Objectif" %}</div>
                    <div class="supper-objective-value blue">{{ stats_objectifs.total_objectif|floatformat:0|intcomma }}</div>
                    <div class="supper-objective-unit">FCFA</div>
                </div>
                
                <div class="supper-objective">
                    <div class="supper-objective-label">{% trans "R√©alis√©" %}</div>
                    <div class="supper-objective-value green">{{ stats_objectifs.total_realise|floatformat:0|intcomma }}</div>
                    <div class="supper-objective-unit">FCFA</div>
                </div>
                
                <div class="supper-objective">
                    <div class="supper-objective-label">{% trans "Reste" %}</div>
                    <div class="supper-objective-value amber">{{ stats_objectifs.reste_a_realiser|floatformat:0|intcomma }}</div>
                    <div class="supper-objective-unit">FCFA</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 1.25rem;">
                <a href="{% url 'inventaire:gestion_objectifs_annuels' %}?annee={{ stats_objectifs.annee }}" class="supper-link-btn">
                    <i class="fas fa-cog"></i>
                    {% trans "G√©rer les objectifs d√©taill√©s" %}
                </a>
            </div>
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- GRAPHIQUES -->
        <!-- ============================================================ -->
        {% if can_view_graphs and graph_data_json %}
        <div class="supper-charts">
            <div class="supper-section">
                <h2 class="supper-section-title">
                    <i class="fas fa-chart-area"></i> 
                    {% trans "√©volution des Recettes (7 jours)" %}
                </h2>
                <div class="supper-chart-container">
                    <canvas id="chartRecettes"></canvas>
                </div>
            </div>

            <!-- Graphique Taux -->
            {% if user_permissions.acces_global.voir_taux_deperdition %}
            <div class="supper-section">
                <h2 class="supper-section-title">
                    <i class="fas fa-chart-bar"></i> 
                    {% trans "Taux de D√©perdition (7 jours)" %}
                </h2>
                <div class="supper-chart-container">
                    <canvas id="chartTaux"></canvas>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- RANG POSTE P√©AGE -->
        <!-- ============================================================ -->
        {% if rang_poste_peage and rang_poste_peage.rang %}
        <div class="supper-section">
            <div class="supper-rank">
                <div class="supper-rank-badge {% if rang_poste_peage.rang == 1 %}gold{% elif rang_poste_peage.rang == 2 %}silver{% elif rang_poste_peage.rang == 3 %}bronze{% else %}default{% endif %}">
                    {{ rang_poste_peage.rang }}{% if rang_poste_peage.rang == 1 %}<sup style="font-size: 0.5em;">er</sup>{% endif %}
                </div>
                <div class="supper-rank-info">
                    <h4>
                        <i class="fas fa-road" style="margin-right: 0.5rem;"></i>
                        {% if rang_poste_peage.rang == 1 %}
                        √∞≈∏¬è‚Ä† {% trans "Meilleur poste de p√©age !" %}
                        {% elif rang_poste_peage.rang <= 3 %}
                        √∞≈∏¬•ÀÜ {% trans "Top 3 des postes de p√©age" %}
                        {% elif rang_poste_peage.rang <= 5 %}
                        √¢¬≠¬ê {% trans "Top 5 des postes" %}
                        {% else %}
                         {% trans "Votre classement p√©age" %}
                        {% endif %}
                    </h4>
                    <p>{{ rang_poste_peage.rang }}{% if rang_poste_peage.rang == 1 %}er{% else %}eme{% endif %} {% trans "sur" %} {{ rang_poste_peage.total_postes }} {% trans "postes de p√©age" %}</p>
                    <small>{% trans "Total recettes" %} {{ current_year }}: {{ rang_poste_peage.total_recettes|floatformat:0|intcomma }} FCFA</small>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- STATISTIQUES PESAGE -->
        <!-- ============================================================ -->
        {% if has_pesage_access and stats_pesage %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-weight-scale" style="color: #7c3aed;"></i> 
                {% trans "Module Pesage" %}
                <span class="supper-section-meta">
                    {{ stats_pesage.label_scope }}
                    {% if stats_pesage.jour_travail %}
                    <span style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; background: #ede9fe; border-radius: 4px; font-size: 0.7rem;">
                        {% trans "Jour:" %} {{ stats_pesage.jour_travail|date:"d/m/Y" }} (9h-9h)
                    </span>
                    {% endif %}
                </span>
            </h2>
            
            <div class="supper-pesage-stats">
                <!-- Pes√©es -->
                {% if stats_pesage.can_saisir_pesee or stats_pesage.can_voir_historique %}
                <div class="supper-pesage-stat purple">
                    <div class="supper-pesage-stat-label"><i class="fas fa-balance-scale"></i> {% trans "Pes√©es Jour" %}</div>
                    <div class="supper-pesage-stat-value">{{ stats_pesage.pesees_jour|default:"√¢‚Ç¨‚Äù" }}</div>
                </div>
                {% endif %}
                
                <!-- √©missions -->
                <div class="supper-pesage-stat amber">
                    <div class="supper-pesage-stat-label"><i class="fas fa-file-invoice"></i> {% trans "√©missions Jour" %}</div>
                    <div class="supper-pesage-stat-value">{{ stats_pesage.emissions_jour|default:0 }}</div>
                    <div class="supper-pesage-stat-unit">{% trans "dont" %} {{ stats_pesage.hors_gabarit_jour|default:0 }} HG</div>
                </div>
                
                <div class="supper-pesage-stat blue">
                    <div class="supper-pesage-stat-label"><i class="fas fa-coins"></i> {% trans "√©mis Jour" %}</div>
                    <div class="supper-pesage-stat-value">{{ stats_pesage.montant_emis_jour|floatformat:0|intcomma }}</div>
                    <div class="supper-pesage-stat-unit">FCFA</div>
                </div>
                
                <!-- Recouvr√© -->
                {% if stats_pesage.can_valider_paiement or stats_pesage.can_voir_recettes %}
                <div class="supper-pesage-stat green">
                    <div class="supper-pesage-stat-label"><i class="fas fa-hand-holding-usd"></i> {% trans "Recouvr√© Jour" %}</div>
                    <div class="supper-pesage-stat-value">{{ stats_pesage.montant_recouvre_jour|floatformat:0|intcomma }}</div>
                    <div class="supper-pesage-stat-unit">{{ stats_pesage.paiements_jour }} paiement{{ stats_pesage.paiements_jour|pluralize }}</div>
                </div>
                
                <div class="supper-pesage-stat red">
                    <div class="supper-pesage-stat-label"><i class="fas fa-clock"></i> {% trans "Reste Jour" %}</div>
                    <div class="supper-pesage-stat-value">{{ stats_pesage.reste_a_recouvrer_jour|floatformat:0|intcomma }}</div>
                    <div class="supper-pesage-stat-unit">FCFA</div>
                </div>
                {% endif %}
                
                <div class="supper-pesage-stat outline {% if stats_pesage.amendes_non_payees > 0 %}warning-border{% else %}success-border{% endif %}">
                    <div class="supper-pesage-stat-label"><i class="fas fa-hourglass-half"></i> {% trans "Non Pay√©es" %}</div>
                    <div class="supper-pesage-stat-value" style="color: {% if stats_pesage.amendes_non_payees > 0 %}#f59e0b{% else %}#10b981{% endif %};">
                        {{ stats_pesage.amendes_non_payees|default:0 }}
                    </div>
                    <div class="supper-pesage-stat-unit" style="color: #64748b;">{{ stats_pesage.montant_non_paye_total|floatformat:0|intcomma }} FCFA</div>
                </div>
            </div>
            
            <!-- Stats du mois -->
            {% if stats_pesage.can_voir_stats %}
            <div class="supper-month-stats">
                <h4>
                    <i class="fas fa-calendar-alt"></i> 
                    {% trans "Statistiques du mois" %} ({{ current_month }} {{ current_year }})
                </h4>
                <div class="supper-month-grid">
                    <div class="supper-month-item">
                        <label>{% trans "√©missions" %}</label>
                        <span class="blue">{{ stats_pesage.emissions_mois }}</span>
                    </div>
                    <div class="supper-month-item">
                        <label>{% trans "Montant √©mis" %}</label>
                        <span class="amber">{{ stats_pesage.montant_emis_mois|floatformat:0|intcomma }}</span>
                    </div>
                    <div class="supper-month-item">
                        <label>{% trans "Recouvr√©" %}</label>
                        <span class="green">{{ stats_pesage.montant_recouvre_mois|floatformat:0|intcomma }}</span>
                    </div>
                    <div class="supper-month-item">
                        <label>{% trans "Taux Recouvrement" %}</label>
                        <span class="{% if stats_pesage.taux_recouvrement_mois >= 80 %}green{% elif stats_pesage.taux_recouvrement_mois >= 50 %}amber{% else %}red{% endif %}">
                            {{ stats_pesage.taux_recouvrement_mois }}%
                        </span>
                    </div>
                    {% if stats_pesage.quittancements_mois is not None %}
                    <div class="supper-month-item">
                        <label>{% trans "Quittancements" %}</label>
                        <span class="purple">{{ stats_pesage.quittancements_mois }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Rang station pesage -->
            {% if rang_station_pesage and rang_station_pesage.rang %}
            <div class="supper-rank" style="margin-top: 1.25rem; background: linear-gradient(135deg, #ede9fe, #ddd6fe);">
                <div class="supper-rank-badge {% if rang_station_pesage.rang == 1 %}gold{% elif rang_station_pesage.rang == 2 %}silver{% elif rang_station_pesage.rang == 3 %}bronze{% else %}purple{% endif %}">
                    {{ rang_station_pesage.rang }}{% if rang_station_pesage.rang == 1 %}<sup style="font-size: 0.5em;">er</sup>{% elif rang_station_pesage.rang <= 3 %}<sup style="font-size: 0.5em;">e</sup>{% endif %}
                </div>
                <div class="supper-rank-info">
                    <h4 style="color: #5b21b6;">
                        {% if rang_station_pesage.rang == 1 %}
                        √∞≈∏¬è‚Ä† {% trans "Champion des stations !" %}
                        {% elif rang_station_pesage.rang <= 3 %}
                        √∞≈∏¬•ÀÜ {% trans "Dans le top 3 !" %}
                        {% elif rang_station_pesage.rang <= 5 %}
                        √¢¬≠¬ê {% trans "Dans le top 5" %}
                        {% else %}
                        √∞≈∏‚Äú≈† {% trans "Classement actuel" %}
                        {% endif %}
                    </h4>
                    <p style="color: #7c3aed;">{{ rang_station_pesage.rang }}{% if rang_station_pesage.rang == 1 %}re{% else %}√®me{% endif %} {% trans "position sur" %} {{ rang_station_pesage.total_stations }} {% trans "stations" %}</p>
                    <small style="color: #6d28d9;">
                        {% trans "Total recouvr√©:" %} {{ rang_station_pesage.total_recouvre|floatformat:0|intcomma }} FCFA
                        {% if rang_station_pesage.taux_recouvrement %}
                        √¢‚Ç¨¬¢ {% trans "Taux:" %} {{ rang_station_pesage.taux_recouvrement }}%
                        {% endif %}
                    </small>
                </div>
            </div>
            {% endif %}
            
            <!-- Alertes pesage -->
            {% if stats_pesage.demandes_confirmation_attente and stats_pesage.demandes_confirmation_attente > 0 %}
            <div class="supper-alert warning">
                <i class="fas fa-bell"></i>
                <div class="supper-alert-content">
                    <strong>{{ stats_pesage.demandes_confirmation_attente }} {% trans "demande" %}{{ stats_pesage.demandes_confirmation_attente|pluralize }} {% trans "de confirmation en attente" %}</strong>
                    <small>{% trans "Des r√©gisseurs d'autres stations attendent votre validation." %}</small>
                </div>
                <a href="{% url 'inventaire:demandes_confirmation_a_traiter' %}" class="supper-alert-action">{% trans "Traiter" %}</a>
            </div>
            {% endif %}
            
            {% if stats_pesage.mes_saisies_jour is not None %}
            <div class="supper-alert info">
                <i class="fas fa-user-edit"></i>
                <div class="supper-alert-content">
                    <strong>{% trans "Vos saisies aujourd'hui :" %} {{ stats_pesage.mes_saisies_jour }} {% trans "amende" %}{{ stats_pesage.mes_saisies_jour|pluralize }}</strong>
                </div>
            </div>
            {% endif %}
            
            <!-- Actions rapides pesage -->
            <div class="supper-actions-bar">
                {% if stats_pesage.can_saisir_amende %}
                <a href="{% url 'inventaire:saisir_amende' %}" class="supper-btn purple">
                    <i class="fas fa-plus"></i>{% trans "Saisir Amende" %}
                </a>
                {% endif %}
                
                {% if stats_pesage.can_saisir_pesee %}
                <a href="{% url 'inventaire:saisir_pesees' %}" class="supper-btn indigo">
                    <i class="fas fa-balance-scale"></i>{% trans "Saisir Pes√©es" %}
                </a>
                {% endif %}
                
                {% if stats_pesage.can_valider_paiement %}
                <a href="{% url 'inventaire:liste_amendes_a_valider' %}" class="supper-btn green">
                    <i class="fas fa-check-double"></i>{% trans "Valider Paiements" %}
                    {% if stats_pesage.amendes_non_payees > 0 %}
                    <span class="badge">{{ stats_pesage.amendes_non_payees }}</span>
                    {% endif %}
                </a>
                {% endif %}
                
                {% if stats_pesage.can_saisir_quittance %}
                <a href="{% url 'inventaire:saisie_quittancement_pesage' %}" class="supper-btn pink">
                    <i class="fas fa-receipt"></i>{% trans "Quittancement" %}
                </a>
                {% endif %}
                
                <a href="{% url 'inventaire:liste_amendes' %}" class="supper-btn blue">
                    <i class="fas fa-list"></i>{% trans "Liste Amendes" %}
                </a>
                
                {% if stats_pesage.can_voir_recettes %}
                <a href="{% url 'inventaire:recettes_pesage' %}" class="supper-btn outline">
                    <i class="fas fa-coins"></i>{% trans "Recettes" %}
                </a>
                {% endif %}
                
                {% if stats_pesage.can_voir_stats %}
                <a href="{% url 'inventaire:statistiques_pesage' %}" class="supper-btn outline">
                    <i class="fas fa-chart-bar"></i>{% trans "Statistiques" %}
                </a>
                {% endif %}
                
                <a href="{% url 'inventaire:recherche_historique_vehicule' %}" class="supper-btn outline">
                    <i class="fas fa-search"></i>{% trans "Historique V√©hicule" %}
                </a>
            </div>
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- ALERTES -->
        <!-- ============================================================ -->
        {% if alertes %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-bell"></i>
                {% trans "Alertes" %}
                <span class="supper-section-meta">{{ alertes|length }} {% trans "notification" %}{{ alertes|length|pluralize }}</span>
            </h2>
            
            {% for alerte in alertes %}
            <div class="supper-alert {% if alerte.type == 'warning' %}warning{% else %}info{% endif %}">
                <i class="{{ alerte.icon }}"></i>
                <div class="supper-alert-content">
                    <strong>{{ alerte.titre }}</strong>
                    <small>{{ alerte.message }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- ACTIVIT√©S R√©CENTES -->
        <!-- ============================================================ -->
        {% if activites_recentes %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-history"></i>
                {% if user_permissions.gestion.peut_voir_journal_audit %}
                {% trans "Activit√©s R√©centes (Global)" %}
                {% else %}
                {% trans "Vos Activit√©s R√©centes" %}
                {% endif %}
            </h2>
            
            <ul class="supper-activity-list">
                {% for activite in activites_recentes %}
                <li class="supper-activity-item">
                    <div class="supper-activity-icon">
                        {% if activite.succes %}
                        <i class="fas fa-check"></i>
                        {% else %}
                        <i class="fas fa-times" style="color: #ef4444;"></i>
                        {% endif %}
                    </div>
                    <div class="supper-activity-content">
                        <strong>{{ activite.action }}</strong>
                        <small>
                            {% if user_permissions.gestion.peut_voir_journal_audit and activite.utilisateur %}
                            {{ activite.utilisateur.nom_complet }} - 
                            {% endif %}
                            {{ activite.details|truncatechars:60 }}
                        </small>
                    </div>
                    <span class="supper-activity-time">{{ activite.timestamp|date:"d/m H:i" }}</span>
                </li>
                {% endfor %}
            </ul>
            
            {% if user_permissions.gestion.peut_voir_journal_audit %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="{% url 'accounts:journal_audit' %}" class="supper-link-btn">
                    <i class="fas fa-external-link-alt"></i>
                    {% trans "Voir le journal complet" %}
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- TOP POSTES -->
        <!-- ============================================================ -->
        {% if can_view_classement and top_postes %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-trophy"></i>
                {% trans "Top 5 Postes (30 derniers jours)" %}
            </h2>
            
            <div class="supper-top-postes-container">
                <table class="supper-top-postes-table">
                    <thead>
                        <tr>
                            <th>{% trans "Rang" %}</th>
                            <th>{% trans "Poste" %}</th>
                            <th style="text-align: right;">{% trans "Recettes" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for poste in top_postes %}
                        <tr>
                            <td>
                                <span style="display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 50%; font-weight: 700; font-size: 0.8rem;
                                    {% if poste.rang == 1 %}background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f;
                                    {% elif poste.rang == 2 %}background: linear-gradient(135deg, #d1d5db, #9ca3af); color: #374151;
                                    {% elif poste.rang == 3 %}background: linear-gradient(135deg, #d97706, #b45309); color: #fff;
                                    {% else %}background: #f1f5f9; color: #475569;{% endif %}">
                                    {{ poste.rang }}
                                </span>
                            </td>
                            <td>
                                <strong style="color: #1e293b;">{{ poste.nom }}</strong>
                                <br><small style="color: #64748b;">{{ poste.code }}</small>
                            </td>
                            <td style="text-align: right; font-weight: 600; color: #059669;">
                                {{ poste.total|floatformat:0|intcomma }} FCFA
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- ============================================================ -->
        <!-- STATISTIQUES SYSTEME -->
        <!-- ============================================================ -->
        {% if stats_systeme and user_permissions.gestion.peut_voir_journal_audit %}
        <div class="supper-section">
            <h2 class="supper-section-title">
                <i class="fas fa-server"></i>
                {% trans "Statistiques Syst√®me" %}
            </h2>
            
            <div class="supper-stats" style="margin-bottom: 0;">
                <div class="supper-stat-card blue">
                    <div class="supper-stat-header">
                        <span class="supper-stat-label">{% trans "Actions Aujourd'hui" %}</span>
                        <div class="supper-stat-icon blue">
                            <i class="fas fa-bolt"></i>
                        </div>
                    </div>
                    <div class="supper-stat-value">{{ stats_systeme.actions_today }}</div>
                    <div class="supper-stat-detail">{{ stats_systeme.actions_succes }} {% trans "r√©ussies" %}</div>
                </div>
                
                {% if stats_systeme.derniere_saisie %}
                <div class="supper-stat-card green">
                    <div class="supper-stat-header">
                        <span class="supper-stat-label">{% trans "Derni√®re Saisie Inventaire" %}</span>
                        <div class="supper-stat-icon green">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                    </div>
                    <div class="supper-stat-value" style="font-size: 1rem;">{{ stats_systeme.derniere_saisie.poste.nom|truncatechars:20 }}</div>
                    <div class="supper-stat-detail">{{ stats_systeme.derniere_saisie.date_creation|date:"d/m/Y H:i" }}</div>
                </div>
                {% endif %}
                
                {% if stats_systeme.derniere_recette %}
                <div class="supper-stat-card amber">
                    <div class="supper-stat-header">
                        <span class="supper-stat-label">{% trans "Derni√®re Recette" %}</span>
                        <div class="supper-stat-icon amber">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                    <div class="supper-stat-value" style="font-size: 1rem;">{{ stats_systeme.derniere_recette.poste.nom|truncatechars:20 }}</div>
                    <div class="supper-stat-detail">{{ stats_systeme.derniere_recette.date_saisie|date:"d/m/Y H:i" }}</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

    </div>
</div>

<!-- ============================================================ -->
<!-- JAVASCRIPT -->
<!-- ============================================================ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Horloge en temps r√©el
    function updateClock() {
        const now = new Date();
        const options = { weekday: 'short', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' };
        const timeEl = document.getElementById('current-time');
        if (timeEl) {
            timeEl.textContent = now.toLocaleDateString('fr-FR', options);
        }
    }
    updateClock();
    setInterval(updateClock, 60000);

    // Configuration Chart.js
    {% if can_view_graphs and graph_data_json %}
    const graphData = {{ graph_data_json|safe }};
    Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
    Chart.defaults.color = '#475569';

    if (graphData.evolution_7j && document.getElementById('chartRecettes')) {
        const ctxRecettes = document.getElementById('chartRecettes').getContext('2d');
        new Chart(ctxRecettes, {
            type: 'line',
            data: {
                labels: graphData.evolution_7j.labels,
                datasets: [{
                    label: 'Recettes (FCFA)',
                    data: graphData.evolution_7j.recettes,
                    borderColor: '#1e40af',
                    backgroundColor: 'rgba(30, 64, 175, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#1e40af',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top', labels: { usePointStyle: true, padding: 20 } },
                    tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.9)', padding: 12, cornerRadius: 8, titleFont: { weight: 'bold' } }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(0, 0, 0, 0.04)' }, ticks: { padding: 10 } },
                    x: { grid: { display: false }, ticks: { padding: 10 } }
                },
                interaction: { intersect: false, mode: 'index' }
            }
        });
    }

    // Graphique Taux
    {% if user_permissions.acces_global.voir_taux_deperdition %}
    if (graphData.evolution_7j && graphData.evolution_7j.show_taux && document.getElementById('chartTaux')) {
        const ctxTaux = document.getElementById('chartTaux').getContext('2d');
        const backgroundColors = graphData.evolution_7j.taux.map(taux => {
            if (taux === null) return 'rgba(156, 163, 175, 0.5)';
            if (taux > -10) return 'rgba(5, 150, 105, 0.7)';
            if (taux >= -30) return 'rgba(217, 119, 6, 0.7)';
            return 'rgba(220, 38, 38, 0.7)';
        });
        const borderColors = graphData.evolution_7j.taux.map(taux => {
            if (taux === null) return '#9ca3af';
            if (taux > -10) return '#059669';
            if (taux >= -30) return '#d97706';
            return '#dc2626';
        });

        new Chart(ctxTaux, {
            type: 'bar',
            data: {
                labels: graphData.evolution_7j.labels,
                datasets: [{
                    label: 'Taux de D√©perdition (%)',
                    data: graphData.evolution_7j.taux,
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top', labels: { usePointStyle: true, padding: 20 } },
                    tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.9)', padding: 12, cornerRadius: 8, titleFont: { weight: 'bold' } }
                },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0, 0, 0, 0.04)' }, ticks: { padding: 10 } },
                    x: { grid: { display: false }, ticks: { padding: 10 } }
                }
            }
        });
    }
    {% endif %}
    {% endif %}
    
    // Correction du d√©filement horizontal sur mobile
    function fixMobileScrolling() {
        if (window.innerWidth <= 768) {
            // Force le conteneur A¬† ne pas d√©passer
            document.querySelectorAll('.supper-dashboard, .supper-container').forEach(el => {
                el.style.overflowX = 'hidden';
                el.style.maxWidth = '100vw';
            });
            
            // Cache les barres de d√©filement horizontales
            document.documentElement.style.overflowX = 'hidden';
            document.body.style.overflowX = 'hidden';
        } else {
            document.documentElement.style.overflowX = 'visible';
            document.body.style.overflowX = 'visible';
        }
    }
    
    fixMobileScrolling();
    window.addEventListener('resize', fixMobileScrolling);
});
</script>
{% endblock %}